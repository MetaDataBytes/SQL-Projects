CREATE TABLE DIM_PRODUCT(
	DIM_PRODUCT_ID INT PRIMARY KEY,
	DIM_COFFEE_TYPE_ID INT NOT NULL FOREIGN KEY REFERENCES DIM_COFFEE_TYPE(DIM_COFFEE_TYPE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	DIM_ROAST_TYPE_ID INT NOT NULL FOREIGN KEY REFERENCES DIM_ROAST_TYPE(DIM_ROAST_TYPE_ID) ON DELETE CASCADE ON UPDATE CASCADE
)

INSERT INTO DIM_PRODUCT
SELECT DISTINCT
	PRODUCT_ID AS DIM_PRODUCT_ID,
	DIM_COFFEE_TYPE_ID,
	DIM_ROAST_TYPE_ID
FROM COFFEE_SALES.DBO.PRODUCT A
INNER JOIN DIM_COFFEE_TYPE B ON A.COFFEE_TYPE_ID = B.DIM_COFFEE_TYPE_ID
INNER JOIN DIM_ROAST_TYPE C ON A.ROAST_TYPE_ID = C.DIM_ROAST_TYPE_ID
WHERE NOT EXISTS(
	SELECT 1
	FROM DIM_PRODUCT
	WHERE A.PRODUCT_ID = DIM_PRODUCT_ID
)