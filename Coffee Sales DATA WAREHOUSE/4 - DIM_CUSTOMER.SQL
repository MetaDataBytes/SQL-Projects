CREATE TABLE DIM_CUSTOMER(
	DIM_CUSTOMER_ID INT PRIMARY KEY,
	DIM_CITY_ID INT NOT NULL FOREIGN KEY REFERENCES DIM_CITY(DIM_CITY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	FIRST_NAME VARCHAR(20) NOT NULL,
	LAST_NAME VARCHAR(20) NOT NULL,
	EMAIL VARCHAR(50),
	PHONE_NUMBER VARCHAR(20),
	STREET VARCHAR(30) NOT NULL,
	LOYALTY_CARD BIT NOT NULL
)

INSERT INTO DIM_CUSTOMER
SELECT DISTINCT
	CUSTOMER_ID AS DIM_CUSTOMER_ID,
	DIM_CITY_ID,
	FIRST_NAME,
	LAST_NAME,
	EMAIL,
	PHONE_NUMBER,
	STREET,
	LOYALTY_CARD
FROM COFFEE_SALES.DBO.CUSTOMER A
INNER JOIN DIM_CITY B ON A.CITY_ID = B.DIM_CITY_ID
WHERE NOT EXISTS(
	SELECT 1
	FROM DIM_CUSTOMER
	WHERE A.CUSTOMER_ID = DIM_CUSTOMER_ID
)