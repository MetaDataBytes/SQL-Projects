CREATE TABLE DIM_CITY(
	DIM_CITY_ID INT PRIMARY KEY,
	DIM_COUNTRY_ID INT NOT NULL FOREIGN KEY REFERENCES DIM_COUNTRY(DIM_COUNTRY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CITY VARCHAR(30) NOT NULL,
	ZIP_CODE CHAR(5) NOT NULL
)

INSERT INTO DIM_CITY
SELECT DISTINCT
	CITY_ID AS DIM_CITY_ID,
	DIM_COUNTRY_ID,
	CITY,
	ZIP_CODE
FROM COFFEE_SALES.DBO.CITY A
INNER JOIN DIM_COUNTRY B ON A.COUNTRY_ID = B.DIM_COUNTRY_ID
WHERE NOT EXISTS(
	SELECT 1 
	FROM DIM_CITY
	WHERE A.CITY_ID = DIM_CITY_ID
)